<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KEY BORROWING</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{
  margin:0;min-height:100vh;
  background:linear-gradient(180deg,#0f1c2e 0%,#132640 60%,#0f1c2e 100%);
  display:flex;justify-content:center;align-items:flex-start;
  padding:24px 12px
}
.form-card{
  width:100%;max-width:520px;
  border-radius:16px;overflow:hidden;
  background:rgba(19,38,64,.55);
  backdrop-filter:blur(12px);
  box-shadow:0 18px 40px rgba(0,0,0,.45);
  color:#fff
}
.form-header{
  padding:22px 20px;
  border-bottom:1px solid rgba(255,255,255,.12)
}
.form-header h1{
  margin:0;font-size:20px;font-weight:500
}
.form-header p{
  margin-top:6px;font-size:12.5px;opacity:.85;line-height:1.4
}
.form-body{padding:22px 20px}
.field{margin-bottom:20px}
label{display:block;font-size:12.5px;font-weight:500;margin-bottom:6px}
input,textarea{
  width:100%;
  border:none;border-bottom:2px solid rgba(255,255,255,.4);
  padding:12px 6px;
  font-size:14px;
  background:transparent;color:#fff;
  outline:none
}
input:focus,textarea:focus{border-bottom-color:#25D366}
textarea{resize:none;min-height:80px}
button{
  width:100%;padding:15px;
  border:none;border-radius:14px;
  background:#25D366;color:#fff;
  font-size:15px;font-weight:600;
  cursor:pointer
}
.form-footer{
  text-align:center;font-size:11px;
  opacity:.6;padding:14px;
  border-top:1px solid rgba(255,255,255,.12)
}
</style>
</head>

<body>

<div class="form-card">
  <div class="form-header">
    <h1>KEY BORROWING</h1>
    <p>Please complete the form before borrowing keys</p>
  </div>

  <div class="form-body">
    <form id="keyForm">

      <div class="field">
        <label>Borrower Name</label>
        <input id="borrowerName" name="borrowerName" required>
      </div>

      <div class="field">
        <label>Department</label>
        <input id="department" name="department" required>
      </div>

      <div class="field">
        <label>Key Number</label>
        <input id="keyNumber" name="keyNumber" required>
      </div>

      <div class="field">
        <label>Key Description</label>
        <textarea id="description" name="description" required></textarea>
      </div>

      <div class="field">
        <label>Quantity of Keys</label>
        <input id="qty" name="qty" required>
      </div>

      <div class="field">
        <label>Security Officer In Charge</label>
        <input id="security" name="security" required>
      </div>

      <div class="field">
        <label>Date & Time Borrowed</label>
        <input id="datetime" name="datetime" readonly>
      </div>

      <button id="btnSubmit" type="submit">SEND VIA WHATSAPP</button>
    </form>
  </div>

  <div class="form-footer">Â© KEY BORROWING</div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw4plcWz70nTSHKoDV0RIw2GfdnUwPR7H-MAyfd52WWK1yEhfSb7JuVfDe19jBiMjBgNg/exec";
const WA_NUMBER = "6281314414955";

let isSending = false;

// auto datetime (IDENTIK REGISTRASI MASUK)
const now = new Date();
document.getElementById("datetime").value =
  now.toLocaleDateString("en-GB") + " " +
  now.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});

document.getElementById("keyForm").addEventListener("submit", function(e){
  e.preventDefault();
  if(isSending) return;

  isSending = true;
  btnSubmit.disabled = true;

  // SAFE VALUE PICKER (HP & PC)
  const borrowerName = document.getElementById("borrowerName").value;
  const departmentVal = document.getElementById("department").value;
  const keyNumberVal = document.getElementById("keyNumber").value;
  const descriptionVal = document.getElementById("description").value;
  const qtyVal = document.getElementById("qty").value;
  const securityVal = document.getElementById("security").value;
  const datetimeVal = document.getElementById("datetime").value;

  // SEND TO GOOGLE SHEET (background)
  const formData = new FormData(document.getElementById("keyForm"));

fetch(WEBAPP_URL,{
  method: "POST",
  body: formData
});


  // WHATSAPP MESSAGE (clean)
  const msg =
`KEY BORROWING

Name: ${borrowerName}
Department: ${departmentVal}
Key Number: ${keyNumberVal}
Description: ${descriptionVal}
Quantity: ${qtyVal}
Security: ${securityVal}
Date & Time: ${datetimeVal}`;

  window.open(
    "https://wa.me/" + WA_NUMBER + "?text=" + encodeURIComponent(msg),
    "_blank"
  );

  document.getElementById("datetime").value =
  new Date().toLocaleDateString("en-GB") + " " +
  new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});

  setTimeout(()=>{
    isSending=false;
    btnSubmit.disabled=false;
  },1500);
});
</script>

</body>
</html>
